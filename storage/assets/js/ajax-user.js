function show_error_input(id){$('#'+id).addClass('error');setTimeout(function(){$('#'+id).removeClass('error');},3000);return null;}
var letters=/^[0-9a-zA-Z]+$/;var url=window.location.href;function empty(str){return str.trim()=='';}
function n(title,message,type='info'){return $.notify({title:title,message:message},{type:type,allow_dismiss:true,placement:{from:"bottom",align:"right"},offset:20,spacing:10,z_index:9999999999,delay:4000,timer:1000,animate:{enter:'animated fadeInDown',exit:'animated fadeOutUp'},template:'<div data-notify="container" class="col-md-4 alert alert-{0}" role="alert"><button type="button" aria-hidden="true" class="close" data-notify="dismiss">×</button><span data-notify="icon"></span><span data-notify="title"><strong>{1}</strong></span> <span data-notify="message">{2}</span></div>'});}
function auth(n,premium_page){let login=$('#auth_login').val();let password=$('#auth_password').val();if(!login.match(letters)){return show_error_input('auth_login');}
$.ajax({type:"POST",url:"/app/includes/controller.php",data:"auth=1&login="+login+"&password="+password,dataType:"json",success:function(result){if(!result.status){if(!result.login)show_error_input('auth_login');if(!result.password)show_error_input('auth_password');n.update({'type':'danger','message':result.message,'title':'<strong>Ошибка</strong>'});}else{$('.modal_login').modal('hide');window.location.href=premium_page?'/order/trial':'/cabinet';}}});}
function recovery(n){let email=$('#recovery_email').val();$.ajax({type:"POST",url:"/app/includes/controller.php",data:"recovery_account="+email,dataType:"json",success:function(result){if(!result.status){show_error_input('recovery_email');n.update({'type':'danger','message':result.message,'title':'<strong>Ошибка</strong>'});}else{n.update({'type':'success','message':'Мы отправили код подтверждения, проверьте','title':'<strong>Успешно!</strong>'});$('.recovery_area').html('<input type="hidden" id="recovery_email" value="'+email+'"><h2>Восстановление доступа</h2> Мы отправили письмо на вашу электронную почту<br> <b>'+result.email+'</b> с кодом подтверждения, введите его в поле ниже<form id="recovery_form_step2"> <span>Введите код из письма</span> <input placeholder="123456" type="number" required maxlength="6" id="recovery_code" minlength="6"> <input value="Продолжить" type="submit"></form><script>$( "#recovery_form_step2" ).submit(function( e ) {e.preventDefault();$: f = n(\'Уведомление\', \'Проверяем код подтверждения...\', \'info\');recovery_step2(f);});</script>');}}});}
function recovery_step2(n){let email=$('#recovery_email').val();let code=$('#recovery_code').val();$.ajax({type:"POST",url:"/app/includes/controller.php",data:"recovery_account="+email+"&enter_recovery_code="+code,dataType:"json",success:function(result){if(!result.status){show_error_input('recovery_code');n.update({'type':'danger','message':result.text,'title':'<strong>Ошибка</strong>'});}else{n.update({'type':'success','message':'Теперь установите новый пароль','title':'<strong>Успешно!</strong>'});$('.recovery_area').html('<input type="hidden" id="recovery_email" value="'+email+'"><h2>Изменение пароля</h2> Пожалуйста, придумайте новый пароль,<br> постарайтесь его не забыть<form id="recovery_form_step3"> <span>Введите новый пароль</span> <input placeholder="Введите желаемый пароль" type="password" required maxlength="64" id="recovery_password" minlength="6"> <input value="Сменить пароль" type="submit"></form><script>$( "#recovery_form_step3" ).submit(function( e ) {e.preventDefault();$: f = n(\'Уведомление\', \'Изменяем пароль...\', \'info\');recovery_step3(f);});</script>');}}});}
function recovery_step3(n){let email=$('#recovery_email').val();let password=$('#recovery_password').val();$.ajax({type:"POST",url:"/app/includes/controller.php",data:"recovery_account="+email+"&new_password="+password,dataType:"json",success:function(result){if(!result.status){show_error_input('recovery_code');n.update({'type':'danger','message':result.message,'title':'<strong>Ошибка</strong>'});}else{n.update({'type':'success','message':'Войдите в свой аккаунт с новым паролем','title':'<strong>Успешно!</strong>'});$('#modal_recovery').modal('hide');$('.modal_login').modal('show');}}});}
function enter_code(n,custom_code=''){let code;if(empty(custom_code))code=$('#enter_code').val();else code=custom_code;$.ajax({type:"POST",url:"/app/includes/controller.php",data:"enter_code="+code,dataType:"json",success:function(result){if(!result.status){show_error_input('enter_code');n.update({'type':'danger','message':result.message,'title':'<strong>Ошибка</strong>'});}else{$('.modal_getcode').modal('hide');window.location.href='/order/trial';}}});}
function unlimited_invite(n){let link=$('#unlimited_vk').val();$.ajax({type:"POST",url:"/app/includes/controller.php",data:"unlimited_invite="+link,dataType:"json",success:function(result){if(!result.status){show_error_input('unlimited_vk');n.update({'type':'danger','message':result.text,'title':'<strong>Ошибка</strong>'});}else{n.update({'type':'success','message':'Проверьте, мы вас добавили в закрытую группу','title':'<strong>Успешно!</strong>'});$('.unlimited_invite').fadeOut();}}});}
function signup(n,premium_page){let login=$('#signup_login').val();let password=$('#signup_password').val();if(!login.match(letters)){return show_error_input('signup_login');}
$.ajax({type:"POST",url:"/app/includes/controller.php",data:"auth=2&login="+login+"&password="+password,dataType:"json",success:function(result){if(!result.status){if(!result.login)show_error_input('signup_login');if(!result.password)show_error_input('signup_password');n.update({'type':'danger','message':result.message,'title':'<strong>Ошибка</strong>'});}else{$('.modal_signup').modal('hide');window.location.href=premium_page?'/order/trial':'/cabinet';}}});}
function settings_resetHWID(){$.ajax({type:"POST",url:"/app/includes/controller.php",data:"settings=1&resetHWID=1",dataType:"json",success:function(result){if(!result.status)n('Ошибка!','Вы уже сбрасывали привязку за последние 24 часа','danger');else n('Успешно!','Привязка сброшена','success');}});}
function settings_cancelRecurring(){let reason=$('#cancelRecurring_reason').val();$('.modal_cancelRecurring').modal('hide');$.ajax({type:"POST",url:"/app/includes/controller.php",data:"settings=1&cancelRecurring="+encodeURI(reason),dataType:"json",success:function(result){if(result.status)n('Успешно!','Автопродление отключено','success');else n('Ошибка!','Согласно пункту 5.2. пользовательского соглашения отменить подписку вы можете спустя 40 часов после её получения','danger');$('#settings_cancelRecurring').remove();}});}
function settings_getSpecial(){$('.modal_special').modal('hide');$.ajax({type:"POST",url:"/app/includes/controller.php",data:"settings=1&getSpecial=1",dataType:"json",success:function(result){if(result.status){n('Успешно!','Специальные условия активированы для тебя','success');setTimeout(function(){window.location.href='/cabinet';},1000);$('#settings_cancelRecurring').remove();}else n('Ошибка!',result.message,'danger');}});}